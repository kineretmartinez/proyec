<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin | Carga de Datos</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background-color: #9f2241; /* Color principal (Rojo/Vino) */
            color: white;
        }
        .logo {
            height: 60px;
        }
        .offcanvas-header {
            background-color: #9f2241;
            color: white;
        }
        .menu-btn {
            background-color: #ffc107; /* Amarillo de advertencia */
            color: #212529;
            font-weight: bold;
            border: none;
        }
        .admin-card {
            background-color: #f8f9fa; 
            color: #212529; /* Texto negro */
            padding: 25px;
            border-radius: 15px;
        }
        .custom-form-group {
            background-color: #e9ecef; /* Fondo gris claro */
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #ced4da;
        }
        .alert-fixed {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
    </style>
</head>

<body class="p-3">

    <header class="mb-4">
        <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded-4 shadow">
            <div class="d-flex gap-3 align-items-center">
                <a href="/">
                    <img src="https://campeche.gob.mx/wp-content/uploads/2023/04/logoh.png" alt="Gobierno de Campeche" class="logo">
                </a>
            </div>
            
            <div class="d-flex flex-column align-items-center me-auto ms-auto text-dark">
                <h1>Panel de Carga de Datos</h1>
                <h3>Alimentaci√≥n de Indicadores (CSV/Excel)</h3>
            </div>

            <button class="btn btn-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuAdmin" aria-controls="menuAdmin">
                Men√∫
            </button>
        </div>
    </header>

    <div class="offcanvas offcanvas-end" tabindex="-1" id="menuAdmin" aria-labelledby="menuAdminLabel">
        <div class="offcanvas-header">
            <h5 id="menuAdminLabel">Opciones</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="list-group">
                <li class="list-group-item">
                    <a href="/" class="text-decoration-none text-dark fw-bold">
                        üè† Volver al Dashboard
                    </a>
                </li>
                
                <% if (typeof user !== 'undefined' && (user.rol === 'admin' || user.rol === 'usuario_tecnico')) { %>
                    <li class="list-group-item active bg-warning text-dark">
                        <a href="/admin/carga-datos" class="text-decoration-none text-dark fw-bold">
                            üìä Carga de Datos (Actual)
                        </a>
                    </li>
                <% } %>
                
                <% if (typeof user !== 'undefined' && user.rol === 'admin') { %>
                    <li class="list-group-item">
                        <a href="/admin/usuarios" class="text-decoration-none text-dark fw-bold">
                            üîß Gesti√≥n de Usuarios
                        </a>
                    </li>
                <% } %>
                
                <li class="list-group-item">
                    <a href="/logout" class="text-decoration-none text-danger fw-bold">
                        üö™ Cerrar Sesi√≥n
                    </a>
                </li>
            </ul>
        </div>
    </div>
    
    <main class="container mt-4">
        <div class="admin-card shadow-lg">
            <h4 class="text-dark mb-4">M√≥dulo de Carga de Indicadores</h4>

            <form action="/api/upload-data" method="POST" enctype="multipart/form-data">
                <div class="custom-form-group">
                    <h5 class="text-dark mb-3">Subir Archivo de Datos (CSV/Excel)</h5>
                    
                    <div class="d-flex align-items-center gap-3">
                        <input class="form-control" type="file" id="archivoData" name="datafile" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" required>
                        <a href="/plantilla-indicadores.xlsx" class="btn btn-secondary flex-shrink-0" download>
                            Descargar Plantilla
                        </a>
                    </div>
                    
                    <small class="text-dark mt-2 d-block">El archivo debe contener columnas para "A√±o" y "Mes" (en espa√±ol o ingl√©s) y el nombre de tus indicadores. El sistema las detectar√° autom√°ticamente.</small>
                </div>

                <div class="mb-3">
                    <label for="nombreIndicador" class="form-label text-dark">Nombre del Indicador (Se usa para registrar la carga)</label>
                    <input type="text" class="form-control" id="nombreIndicador" name="nombreIndicador" required>
                </div>

                <div class="mb-4">
                    <label for="tipoTabla" class="form-label text-dark">Tipo de Tabla/Indicador a Actualizar</label>
                    <select class="form-select" id="tipoTabla" name="tipoTabla" required>
                        <option value="">Seleccione a d√≥nde cargar los datos...</option>
                        <option value="indicadores_sociales">Indicadores Sociales</option>
                        <option value="indicadores_educacion_cultura">Educaci√≥n y Cultura</option>
                        <option value="indicadores_salud">Salud y Bienestar</option>
                        <option value="indicadores_inclusion">Inclusi√≥n, Vivienda y Seguridad</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label for="nota" class="form-label text-dark">Nota de la Carga (Opcional)</label>
                    <textarea class="form-control" id="nota" name="nota" rows="3"></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-lg w-100" style="background-color: #bca986; border-color: #bca986;">
                    Procesar y Subir Datos
                </button>
            </form>

        </div>
    </main>

    <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded-4 shadow mt-4">
        <div class="d-flex gap-3 align-items-center">
            <img src="https://campeche.gob.mx/wp-content/uploads/2023/04/logoh.png" alt="Gobierno de Campeche" class="logo">
            <img src="https://cedyc.campeche.gob.mx/wp-content/uploads/2023/05/Gabinete/curriculum/Logo_cedyc_horizontal.svg" alt="CEDYC" class="logo">
            <img src="https://th.bing.com/th/id/R.70f86f90b79935c5277de32f0cc535a0?rik=vvSvN%2b8aZjkeOA&riu=http%3a%2f%2fsic.gob.mx%2fimages%2f62651&ehk=Dr1LAHN94y5xu2OBSHc0b4%2ftnzTECmGHPSds9ZqT4lY%3d&risl=&pid=ImgRaw&r=0" alt="Tecnol√≥gico de Chin√°" class="logo">
            <img src="https://extranet.inegi.org.mx/assets/img/Imagen_Institucional/Logos/Logo4.jpg" alt="INEGI" class="logo">
            <img src="https://educacioncampeche.gob.mx/img/logo.png" alt="SEDUC" class="logo">
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const successMessage = urlParams.get('success');
            const errorMessage = urlParams.get('error');

            if (successMessage) {
                // Muestra un mensaje de √©xito
                alert(`‚úÖ √âxito: ${decodeURIComponent(successMessage)}`);
                
                // Limpia la URL despu√©s de mostrar el mensaje para evitar re-mostrarlo al recargar
                window.history.replaceState(null, null, window.location.pathname);
            } else if (errorMessage) {
                // Muestra un mensaje de error
                alert(`‚ùå Error: ${decodeURIComponent(errorMessage)}`);
                
                // Limpia la URL despu√©s de mostrar el mensaje
                window.history.replaceState(null, null, window.location.pathname);
            }
        });
    </script>
</body>
</html>