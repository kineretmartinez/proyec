<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin | Carga de Datos</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background-color: #9F2241;
            
            color: white;
        }

        .logo {
            height: 60px;
        }

        .offcanvas-header {
            background-color: #9F2241;
            color: white;
        }

        .menu-btn {
            background-color: #ffc107;
            color: #212529;
            font-weight: bold;
            border: none;
        }

        .admin-card {
            background-color: #f8f9fa;
            color: #212529;
            padding: 25px;
            border-radius: 15px;
        }

        .custom-form-group {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #ced4da;
        }

        .alert-fixed {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
    </style>
</head>

<body class="p-3">

    <header class="mb-4">
        <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded-4 shadow">
            <div class="d-flex gap-3 align-items-center">
                <a href="/">
                    <img src="/img/logos/Gobierno_campeche.webp"alt="Gobierno de Campeche"
                        class="logo">
                </a>
            </div>

            <div class="d-flex flex-column align-items-center me-auto ms-auto text-dark">
                <h1>Panel de Carga de Datos</h1>
                <h3>Alimentaci贸n de Indicadores (CSV/Excel)</h3>
            </div>

            <button class="btn btn-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuAdmin"
                aria-controls="menuAdmin">
                Men煤
            </button>
        </div>
    </header>

    <div class="offcanvas offcanvas-end" tabindex="-1" id="menuAdmin" aria-labelledby="menuAdminLabel">
        <div class="offcanvas-header">
            <h5 id="menuAdminLabel">Opciones</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
                aria-label="Cerrar"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="list-group">
                <li class="list-group-item">
                    <a href="/" class="text-decoration-none text-dark fw-bold">
                         Volver al Dashboard
                    </a>
                </li>

                <% if (typeof user !=='undefined' && (user.rol==='admin' || user.rol==='usuario_tecnico' )) { %>
                    <li class="list-group-item active bg-warning text-dark">
                        <a href="/admin/carga-datos" class="text-decoration-none text-dark fw-bold">
                             Carga de Datos (Actual)
                        </a>
                    </li>
                    <% } %>

                        <% if (typeof user !=='undefined' && user.rol==='admin' ) { %>
                            <li class="list-group-item">
                                <a href="/admin/usuarios" class="text-decoration-none text-dark fw-bold">
                                     Gesti贸n de Usuarios
                                </a>
                            </li>
                            <% } %>

                                <li class="list-group-item">
                                    <a href="/logout" class="text-decoration-none text-danger fw-bold">
                                         Cerrar Sesi贸n
                                    </a>
                                </li>
            </ul>
        </div>
    </div>

    <main class="container mt-4">
        <div class="admin-card shadow-lg">
            <h4 class="text-dark mb-4">M贸dulo de Carga de Indicadores</h4>

            <form action="/api/upload-data" method="POST" enctype="multipart/form-data">
                <div class="custom-form-group">
                    <h5 class="text-dark mb-3">Subir Archivo de Datos (CSV/Excel)</h5>

                    <div class="d-flex align-items-center gap-3">
                        <input class="form-control" type="file" id="archivoData" name="datafile"
                            accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
                            required>
                        <a href="/Documentos/plantilla_datos.xlsx" class="btn btn-secondary flex-shrink-0" download>
                            Descargar Plantilla
                        </a>
                    </div>

                    <small class="text-dark mt-2 d-block">El archivo debe contener la columna para "A帽o" (en espa帽ol o
                        ingl茅s) y los nombres de tus indicadores. El sistema los detectar谩 autom谩ticamente.</small>
                </div>

                <div class="mb-3">
                    <label for="nombreIndicador" class="form-label text-dark">Nombre del Indicador (Se usa para
                        registrar la carga)</label>
                    <input type="text" class="form-control" id="nombreIndicador" name="nombreIndicador" required>
                </div>

                <div class="mb-4">
                    <label for="tipoTabla" class="form-label text-dark">Tipo de Tabla/Indicador a Actualizar</label>
                    <select class="form-select" id="tipoTabla" name="tipoTabla" required>
                        <option value="">Seleccione a d贸nde cargar los datos...</option>
                        <option value="datos_radar">Datos Radar (Pulso Social)</option>
                        <option value="indicadores_sociales">Indicadores Sociales</option>
                        <option value="indicadores_educacion_cultura">Educaci贸n y Cultura</option>
                        <option value="indicadores_salud">Salud y Bienestar</option>
                        <option value="indicadores_inclusion">Inclusi贸n, Vivienda y Seguridad</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label for="nota" class="form-label text-dark">Nota de la Carga (Opcional)</label>
                    <textarea class="form-control" id="nota" name="nota" rows="3"></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-lg w-100"
                    style="background-color: #bca986; border-color: #bca986;">
                    Procesar y Subir Datos
                </button>
            </form>

        </div>
    </main>

    <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded-4 shadow mt-4">
        <div class="d-flex gap-3 align-items-center">
            <img src="/img/logos/Gobierno_campeche.webp" alt="Gobierno de Campeche"class="logo">
            <img src="/img/logos/Logo_cedyc.webp" alt="CEDYC" class="logo">
            <img src="/img/logos/tecnologico_de_china.webp" alt="Tecnol贸gico de Chin谩" class="logo">
            <img src="/img/logos/inegi.webp" alt="INEGI"class="logo">
            <img src="/img/logos/SEDUC.webp" alt="SEDUC" class="logo">
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const successMessage = urlParams.get('success');
            const errorMessage = urlParams.get('error');

            if (successMessage) {
                // Muestra un mensaje de 茅xito
                alert(` xito: ${decodeURIComponent(successMessage)}`);

                // Limpia la URL despu茅s de mostrar el mensaje para evitar re-mostrarlo al recargar
                window.history.replaceState(null, null, window.location.pathname);
            } else if (errorMessage) {
                // Muestra un mensaje de error
                alert(` Error: ${decodeURIComponent(errorMessage)}`);

                // Limpia la URL despu茅s de mostrar el mensaje
                window.history.replaceState(null, null, window.location.pathname);
            }
        });
    </script>
</body>

</html>